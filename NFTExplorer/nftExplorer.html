<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="global.css">
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sscjs@latest/dist/ssc.min.js"></script>
	<script src=https://cdn.jsdelivr.net/npm/@hivechain/hivejs/dist/hivejs.min.js></script>
	<script>
		 let ssc = new SSC('https://api.hive-engine.com/rpc')
	</script>
</head>
    
<body>
	<body id = "body">   
      <div> 
    <h1 style = "color:green;" >   
        Testing Hive Engine API   
    </h1> 
      
    <p id = "header" style =  
        "font-size: 15px; font-weight: bold;"> 
        Click on the button to create a table from the JSON data.<br><br> 
        Show    </p>
          
          <select id="game">
            <option value="STARinstances">Rising Star</option>
            <option value="CITYinstances">DCity</option>  
          </select>
          
          <p id = "headerAccount" style =  
        "font-size: 15px; font-weight: bold;"> 
              NFTs for account: @ </p>
    
	
	<input type="text" id="inputParam" name="inputParam">
      
	 <button id = "mainButton" onclick = "getData(); clearTable()"> 
        Set Account
    </button> 
	
    <button id = "mainButton" onclick = "buildButtonClicked()"> 
        Show NFTs 
    </button> 
	  
    <br><br> 
     </div>   
    <p id ="dataTable"> </p>
      
    <script> 
        
		
		var JSONdata = [];
		                     
		function getData() {
			ssc.find('nft', document.getElementById("game").value, {account:document.getElementById("inputParam").value}, 1000, 0, [], (err, result) => {
				for (i = 0; i < result.length; i++) {
					JSONdata.push(result[i].properties);
					JSONdata[i]._id = result[i]._id;
                    // reorder to show _id first
                    switch(document.getElementById("game").value) {
                        case 'STARinstances': 
                            JSONdata[i] = JSON.parse(JSON.stringify( JSONdata[i], ["_id", "class","stats","type"])); break;
                        case 'CITYinstances':  
                            
                            delete JSONdata[i].population; delete JSONdata[i].education; delete JSONdata[i].creativity; delete JSONdata[i].income; delete JSONdata[i].popularity; delete JSONdata[i].workers;
                            JSONdata[i] = JSON.parse(JSON.stringify( JSONdata[i], ["_id", "name"])); break; 
                           }
										
				}
			}) 
            
            var textHeader = document.getElementById("headerAccount"); 
			textHeader.innerHTML = "NFTs for account: @" + document.getElementById("inputParam").value
		}	
		
        function buildTable() {
            // Get data for table header. 
            var col = [];
            for (var i = 0; i < JSONdata.length; i++) {
                for (var key in JSONdata[i]) {
                    if (col.indexOf(key) === -1) {
                        col.push(key);
                    }
                }
            }
            
             // CREATE DYNAMIC TABLE.
            var table = document.createElement("table");
            
              // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.
            
            var tr = table.insertRow(-1);    
            
            for (var i = 0; i < col.length; i++) {
                var th = document.createElement("th");      // TABLE HEADER.
                th.innerHTML = col[i];
                tr.appendChild(th);
            }
            
            // ADD JSON DATA TO THE TABLE AS ROWS.
            for (var i = 0; i < JSONdata.length; i++) {

                tr = table.insertRow(-1);

                for (var j = 0; j < col.length; j++) {
                    var tabCell = tr.insertCell(-1);
                    tabCell.innerHTML = JSONdata[i][col[j]];
                }
            }
            
            // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
            var divContainer = document.getElementById("dataTable");
            divContainer.innerHTML = "";
            divContainer.appendChild(table);
            
            
        } // end create table function
        
        function buildButtonClicked() {
                buildTable();        
        }
        
        function clearTable() {
            JSONdata = [];
        }
    </script>  
</body>
</html>


